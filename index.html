<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Mercedes-Benz Speciaal Gereedschap Database Ninove"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="MB Tools" />
    <link rel="apple-touch-icon" href="icon-192.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
    <link rel="manifest" href="manifest.json" />
    <title>MB Tools Ninove - TEST VERSIE</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(to bottom right, #f5f5f5, #e8e8e8);
        min-height: 100vh;
      }
      .header {
        background: linear-gradient(to right, #1a1a1a, #2d2d2d, #1a1a1a);
        color: white;
        padding: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1.5rem;
      }
      .logo-section {
        display: flex;
        align-items: center;
        gap: 1.5rem;
      }
      .mercedes-logo {
        width: 80px;
        height: 80px;
        object-fit: contain;
      }
      .title-section h1 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
      }
      .title-section p {
        color: #b0b0b0;
        font-size: 0.95rem;
      }
      .test-badge {
        background: #fbbf24;
        color: #78350f;
        padding: 0.25rem 0.75rem;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 700;
      }
      .stats {
        text-align: right;
      }
      .stats-label {
        font-size: 0.875rem;
        color: #b0b0b0;
        margin-bottom: 0.25rem;
      }
      .stats-value {
        font-size: 2rem;
        font-weight: 700;
        color: #60a5fa;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
      }
      .search-container {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .search-container h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: #1a1a1a;
      }
      .search-input-wrapper {
        position: relative;
        margin-bottom: 0.75rem;
      }
      .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        width: 20px;
        height: 20px;
      }
      #searchInput {
        width: 100%;
        padding: 1rem 1rem 1rem 3rem;
        font-size: 1.125rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        transition: all 0.3s;
      }
      #searchInput:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      .search-hint {
        font-size: 0.875rem;
        color: #6b7280;
        margin-top: 0.5rem;
      }
      .results-container {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .results-header {
        background: #2d2d2d;
        color: white;
        padding: 1.5rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .results-header h3 {
        font-size: 1.25rem;
        font-weight: 600;
      }
      .reset-btn {
        padding: 0.5rem 1rem;
        background: #ef4444;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 600;
      }
      .reset-btn:hover {
        background: #dc2626;
      }
      .result-item {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid #e5e7eb;
      }
      .result-item:hover {
        background-color: #eff6ff;
      }
      .result-item:last-child {
        border-bottom: none;
      }
      .gereedschap-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 0.75rem;
        flex-wrap: wrap;
      }
      .gereedschap-nummer {
        font-family: "Courier New", monospace;
        font-size: 1.25rem;
        font-weight: 700;
        color: #1a1a1a;
        min-width: 200px;
      }
      .status-button {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      }
      .status-button.beschikbaar {
        background: #d1fae5;
        color: #065f46;
      }
      .status-button.beschikbaar:hover {
        background: #a7f3d0;
        transform: scale(1.02);
        box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
      }
      .status-button.ingebruik {
        background: #fee2e2;
        color: #991b1b;
      }
      .status-button.ingebruik:hover {
        background: #fecaca;
        transform: scale(1.02);
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
      }
      .locatie-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 0.75rem;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 600;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
      }
      .locatie-magazijn {
        background: #e0e7ff;
        color: #3730a3;
        border-left: 3px solid #4f46e5;
      }
      .locatie-werkplaats {
        background: #fef3c7;
        color: #92400e;
        border-left: 3px solid #f59e0b;
      }
      .detail-text {
        font-size: 0.875rem;
        color: #991b1b;
        margin-bottom: 0.75rem;
      }
      .detail-text.beschikbaar {
        color: #6b7280;
      }
      .geschiedenis-section {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #e5e7eb;
      }
      .geschiedenis-title {
        font-size: 0.75rem;
        font-weight: 700;
        color: #6b7280;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .geschiedenis-item {
        font-size: 0.8rem;
        color: #6b7280;
        padding: 0.25rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .no-results {
        padding: 4rem 2rem;
        text-align: center;
        color: #6b7280;
      }
      .footer {
        background: #1a1a1a;
        color: #b0b0b0;
        padding: 2rem;
        margin-top: 3rem;
        text-align: center;
      }
      .footer p {
        font-size: 0.875rem;
        margin: 0.25rem 0;
      }
      @media (max-width: 768px) {
        .header-content {
          flex-direction: column;
          text-align: center;
        }
        .logo-section {
          flex-direction: column;
        }
        .stats {
          text-align: center;
        }
        .container {
          padding: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header-content">
        <div class="logo-section">
          <img
            src="mb-logo.png"
            alt="Mercedes-Benz Logo"
            class="mercedes-logo"
          />
          <div class="title-section">
            <h1>Mercedes-Benz <span class="test-badge">TEST MODE</span></h1>
            <p>Speciaal Gereedschap Database Ninove</p>
          </div>
        </div>
        <div class="stats">
          <div class="stats-label">Totaal items</div>
          <div class="stats-value" id="totalCount">10</div>
        </div>
      </div>
    </header>

    <main class="container">
      <div class="search-container">
        <h2>Zoek Gereedschap</h2>
        <div class="search-input-wrapper">
          <svg
            class="search-icon"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            />
          </svg>
          <input
            type="text"
            id="searchInput"
            placeholder="Voer gereedschapsnummer in..."
            autocomplete="off"
          />
        </div>
        <p class="search-hint">
          üí° Je mag het gereedschapsnummer ook zonder spaties invoeren
        </p>
      </div>

      <div class="results-container">
        <div class="results-header">
          <h3><span id="resultCount">10</span> resultaten gevonden</h3>
          <button class="reset-btn" onclick="resetAllData()">
            üîÑ Reset Alles
          </button>
        </div>
        <div class="results-list" id="resultsList"></div>
      </div>
    </main>

    <footer class="footer">
      <p>¬© 2025 Mercedes-Benz ‚Ä¢ TEST VERSIE (Lokale opslag)</p>
      <p style="color: #6b7280; margin-top: 0.5rem">
        ‚ö†Ô∏è Data wordt alleen lokaal opgeslagen op dit apparaat
      </p>
    </footer>

    <script>
      // GEBRUIKERS LIJST
      const GEBRUIKERS = [
        "Albin",
        "Chris",
        "Destiny",
        "Dylan",
        "Joeri",
        "Ken",
        "Kris",
        "Luc",
        "Marc",
        "Maxime",
        "Michael",
        "Philippe",
        "EXTERN",
      ];

      // TEST DATA - Formaat: [gereedschapnummer, locatie]
      const gereedschapData = [
        ["000 581 25 58", "Magazijn: rek 1518 ‚Ä¢ schap 0108"],
        ["102 589 00 09 00", "Magazijn: Rek 1518 ‚Ä¢ Schap 0105 ‚Ä¢ Bak 4"],
        ["111 589 00 40 00", "Werkplaats: BORD C"],
        ["210 589 00 07 00", "Magazijn: Rek 1518 ‚Ä¢ Schap 0302"],
        ["210 589 01 43 05", "Magazijn: rek 1518 ‚Ä¢ schap 0303 ‚Ä¢ bak 12"],
        ["230 589 04 63 00", "WERKPLAATS: KAST RIJ 3"],
        ["651 589 00 09 00", "Werkplaats: bord A"],
        ["103 589 00 33 00", "Magazijn: Rek 1518 ‚Ä¢ Schap 0106"],
        ["220 589 00 07 00", "Werkplaats: KAST RIJ 1"],
        ["129 589 00 21 00", "Magazijn: Rek 1518 ‚Ä¢ Schap 0201 ‚Ä¢ BAK 8"],
      ];

      // LOCALSTORAGE FUNCTIES
      function loadStatus() {
        const data = localStorage.getItem("mbtools_status");
        return data ? JSON.parse(data) : {};
      }

      function saveStatus(statusData) {
        localStorage.setItem("mbtools_status", JSON.stringify(statusData));
      }

      function resetAllData() {
        if (
          confirm(
            "‚ö†Ô∏è Weet je zeker dat je alle data wilt wissen?\n\nAlle statussen en geschiedenis worden verwijderd."
          )
        ) {
          localStorage.removeItem("mbtools_status");
          alert("‚úÖ Alle data is gewist!");
          location.reload();
        }
      }

      // GEREEDSCHAP UITLENEN
      function leenUit(gereedschapNr, gebruiker) {
        if (!gebruiker || gebruiker.trim() === "") {
          alert("‚ö†Ô∏è Geen geldige gebruiker geselecteerd");
          return;
        }

        const statusData = loadStatus();

        statusData[gereedschapNr] = {
          status: "uitgeleend",
          gebruiker: gebruiker,
          sinds: new Date().toISOString(),
          geschiedenis: statusData[gereedschapNr]?.geschiedenis || [],
        };

        saveStatus(statusData);
        alert(`‚úÖ Gereedschap ${gereedschapNr} in gebruik door ${gebruiker}`);
        location.reload();
      }

      // GEREEDSCHAP TERUGBRENGEN
      function brengTerug(gereedschapNr) {
        if (!confirm(`Wil je gereedschap ${gereedschapNr} terugbrengen?`)) {
          return;
        }

        const statusData = loadStatus();

        if (statusData[gereedschapNr]) {
          // Voeg toe aan geschiedenis
          if (!statusData[gereedschapNr].geschiedenis) {
            statusData[gereedschapNr].geschiedenis = [];
          }

          statusData[gereedschapNr].geschiedenis.push({
            gebruiker: statusData[gereedschapNr].gebruiker,
            van: statusData[gereedschapNr].sinds,
            tot: new Date().toISOString(),
          });

          // Verwijder huidige uitlening
          statusData[gereedschapNr].status = "beschikbaar";
          delete statusData[gereedschapNr].gebruiker;
          delete statusData[gereedschapNr].sinds;
        }

        saveStatus(statusData);
        alert(`‚úÖ Gereedschap ${gereedschapNr} teruggebracht`);
        location.reload();
      }

      // TOON UITLEENPOPUP
      function toonUitleenPopup(gereedschapNr) {
        const keuze = prompt(
          `Wie gebruikt gereedschap ${gereedschapNr}?\n\n` +
            GEBRUIKERS.map((naam, i) => `${i + 1}. ${naam}`).join("\n") +
            "\n\nTyp het nummer (1-13) of de volledige naam:"
        );

        if (!keuze) return;

        const nr = parseInt(keuze.trim());
        let gekozenNaam;

        if (nr && nr >= 1 && nr <= GEBRUIKERS.length) {
          gekozenNaam = GEBRUIKERS[nr - 1];
        } else {
          const gevonden = GEBRUIKERS.find(
            (naam) => naam.toLowerCase() === keuze.trim().toLowerCase()
          );
          gekozenNaam = gevonden || keuze.trim();
        }

        leenUit(gereedschapNr, gekozenNaam);
      }

      // ZOEK FUNCTIE
      let currentSearch = "";

      document.addEventListener("DOMContentLoaded", () => {
        displayResults(gereedschapData);
        document
          .getElementById("searchInput")
          .addEventListener("input", handleSearch);
      });

      function handleSearch(e) {
        currentSearch = e.target.value;
        filterAndDisplay();
      }

      function filterAndDisplay() {
        const searchNormalized = currentSearch.replace(/\s/g, "").toLowerCase();

        const filtered = gereedschapData.filter((item) => {
          const itemNormalized = item[0].replace(/\s/g, "").toLowerCase();
          return (
            searchNormalized === "" || itemNormalized.includes(searchNormalized)
          );
        });

        displayResults(filtered);
      }

      // DISPLAY RESULTATEN
      function displayResults(items) {
        const resultsList = document.getElementById("resultsList");
        const resultCount = document.getElementById("resultCount");
        const statusData = loadStatus();

        resultCount.textContent = items.length;

        if (items.length === 0) {
          resultsList.innerHTML = `
                    <div class="no-results">
                        <p style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">Geen resultaten gevonden</p>
                        <p>Probeer een andere zoekopdracht</p>
                    </div>
                `;
          return;
        }

        resultsList.innerHTML = items
          .map((item) => {
            const gereedschapNr = item[0];
            const locatie = item[1];
            const status = statusData[gereedschapNr];
            const isInGebruik = status && status.status === "uitgeleend";

            // Bepaal of het magazijn of werkplaats is
            const isMagazijn = locatie.includes("Magazijn");
            const locatieClass = isMagazijn
              ? "locatie-magazijn"
              : "locatie-werkplaats";
            const locatieIcon = isMagazijn ? "üì¶" : "üîß";

            let statusButton = "";
            let detailHTML = "";
            let geschiedenisHTML = "";

            if (isInGebruik) {
              const sinds = new Date(status.sinds);
              const tijd = sinds.toLocaleString("nl-BE", {
                day: "2-digit",
                month: "short",
                hour: "2-digit",
                minute: "2-digit",
              });

              statusButton = `<button class="status-button ingebruik" onclick="brengTerug('${gereedschapNr}')">üî¥ IN GEBRUIK - Klik om terug te brengen</button>`;
              detailHTML = `<div class="detail-text">Door: <strong>${status.gebruiker}</strong> ‚Ä¢ Sinds: ${tijd}</div>`;

              if (status.geschiedenis && status.geschiedenis.length > 0) {
                const laatste3 = status.geschiedenis.slice(-3).reverse();
                geschiedenisHTML = `
                            <div class="geschiedenis-section">
                                <div class="geschiedenis-title">üìú Recente Geschiedenis</div>
                                ${laatste3
                                  .map((h) => {
                                    const van = new Date(
                                      h.van
                                    ).toLocaleDateString("nl-BE", {
                                      day: "2-digit",
                                      month: "short",
                                    });
                                    const tot = new Date(
                                      h.tot
                                    ).toLocaleDateString("nl-BE", {
                                      day: "2-digit",
                                      month: "short",
                                    });
                                    return `<div class="geschiedenis-item">üîß <strong>${h.gebruiker}</strong> (${van} ‚Üí ${tot})</div>`;
                                  })
                                  .join("")}
                            </div>
                        `;
              }
            } else {
              statusButton = `<button class="status-button beschikbaar" onclick="toonUitleenPopup('${gereedschapNr}')">‚úÖ BESCHIKBAAR - Klik om te gebruiken</button>`;

              if (
                status &&
                status.geschiedenis &&
                status.geschiedenis.length > 0
              ) {
                const laatste3 = status.geschiedenis.slice(-3).reverse();
                const laatsteGebruiker = laatste3[0];
                const laatsteDatum = new Date(
                  laatsteGebruiker.tot
                ).toLocaleDateString("nl-BE", {
                  day: "2-digit",
                  month: "short",
                  year: "numeric",
                });

                detailHTML = `<div class="detail-text beschikbaar">üìÖ Laatst gebruikt door <strong>${laatsteGebruiker.gebruiker}</strong> op ${laatsteDatum}</div>`;

                geschiedenisHTML = `
                            <div class="geschiedenis-section">
                                <div class="geschiedenis-title">üìú Recente Geschiedenis</div>
                                ${laatste3
                                  .map((h) => {
                                    const van = new Date(
                                      h.van
                                    ).toLocaleDateString("nl-BE", {
                                      day: "2-digit",
                                      month: "short",
                                    });
                                    const tot = new Date(
                                      h.tot
                                    ).toLocaleDateString("nl-BE", {
                                      day: "2-digit",
                                      month: "short",
                                    });
                                    return `<div class="geschiedenis-item">üîß <strong>${h.gebruiker}</strong> (${van} ‚Üí ${tot})</div>`;
                                  })
                                  .join("")}
                            </div>
                        `;
              }
            }

            return `
                    <div class="result-item">
                        <div class="gereedschap-header">
                            <div class="gereedschap-nummer">${gereedschapNr}</div>
                            ${statusButton}
                        </div>
                        <div class="locatie-badge ${locatieClass}">
                            ${locatieIcon} ${locatie}
                        </div>
                        ${detailHTML}
                        ${geschiedenisHTML}
                    </div>
                `;
          })
          .join("");
      }
    </script>
  </body>
</html>
